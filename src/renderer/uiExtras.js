// uiExtras.js - rules toggle, reveal buttons, scaling
(function(global){ function rules(){ const t=document.getElementById('rules-toggle'); const c=document.getElementById('rules-collapsible'); if(t&&c&&!t._wired){ t._wired=true; t.addEventListener('click',()=>{ const exp=t.getAttribute('aria-expanded')==='true'; if(exp){ t.setAttribute('aria-expanded','false'); c.classList.add('rules-collapsed'); } else { t.setAttribute('aria-expanded','true'); c.classList.remove('rules-collapsed'); } }); } document.querySelectorAll('.reveal-btn').forEach(btn=>{ if(btn._wired) return; btn._wired=true; btn.addEventListener('click',()=>{ const id=btn.getAttribute('data-target'); const input=document.getElementById(id); if(!input) return; if(input.type==='password'){ input.type='text'; btn.textContent='🙈'; } else { input.type='password'; btn.textContent='👁'; } }); }); }
  function applyScale(){ const baseW=1280, baseH=880; let s=Math.min(window.innerWidth/baseW*0.95, window.innerHeight/baseH*1.05); s=Math.max(0.75, Math.min(1.55,s)); document.documentElement.style.setProperty('--ui-scale', s.toFixed(3)); const ov=document.getElementById('boss-overlay'); if(ov){ ov.style.transform=`scale(${s})`; ov.style.transformOrigin='top center'; fit(); } }
  function fit(){ const ov=document.getElementById('boss-overlay'); const parent=document.getElementById('boss-container'); if(!ov||!parent) return; const pr=parent.getBoundingClientRect(); let cur=1; const m=ov.style.transform.match(/scale\(([^)]+)\)/); if(m) cur=parseFloat(m[1])||1; let safe=24; while(safe-- >0){ const r=ov.getBoundingClientRect(); if(r.bottom<=pr.bottom-6 && r.right<=pr.right-6) break; cur-=0.04; if(cur<0.6){ cur=0.6; break; } ov.style.transform=`scale(${cur.toFixed(3)})`; } }
  function init(){ rules(); applyScale(); window.addEventListener('resize', applyScale); }
  document.addEventListener('DOMContentLoaded', init);
})(typeof window!=='undefined'?window:globalThis);
